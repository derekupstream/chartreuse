// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          String   @id
  name        String?
  email       String   @unique
  title       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  org         Org      @relation(fields: [orgId], references: [id])
  orgId       String   @db.Uuid
  account     Account? @relation(fields: [accountId], references: [id])
  accountId   String?  @db.Uuid
  phone       String?
  role        Role     @default(ORG_ADMIN)
  invitesSent Invite[]
}

model Org {
  id        String    @id @default(uuid()) @db.Uuid
  name      String
  metadata  Json?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  users     User[]
  accounts  Account[]
  projects  Project[]
}

model Account {
  id                  String    @id @default(uuid()) @db.Uuid
  name                String
  metadata            Json?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  org                 Org       @relation(fields: [orgId], references: [id])
  orgId               String    @db.Uuid
  users               User[]
  accountContactEmail String
  invites             Invite[]
  projects            Project[]
}

model Invite {
  id           String   @id @default(uuid()) @db.Uuid
  email        String
  account      Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId    String   @db.Uuid
  accepted     Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  sentBy       User     @relation(fields: [sentByUserId], references: [id], onDelete: Cascade)
  sentByUserId String
}

model Project {
  id                String              @id @default(uuid()) @db.Uuid
  name              String
  metadata          Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  org               Org                 @relation(fields: [orgId], references: [id], onDelete: Cascade)
  orgId             String              @db.Uuid
  account           Account             @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId         String              @db.Uuid
  singleUseItems    SingleUseLineItem[]
  reusableItems     ReusableLineItem[]
  additionalCosts   AdditionalCost[]
  laborCosts        LaborCost[]
  wasteHaulingCosts WasteHaulingCost[]
  DishWasher        Dishwasher[]
}

model SingleUseLineItem {
  id                String  @id @default(uuid()) @db.Uuid
  caseCost          Int
  casesPurchased    Int
  frequency         String
  productId         String
  newCaseCost       Int
  newCasesPurchased Int
  unitsPerCase      Int
  project           Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId         String  @db.Uuid
}

model ReusableLineItem {
  id                         String  @id @default(uuid()) @db.Uuid
  annualRepurchasePercentage Int
  caseCost                   Int
  casesPurchased             Int
  categoryId                 String
  productName                String
  projectId                  String  @db.Uuid
  project                    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model AdditionalCost {
  id         String  @id @default(uuid()) @db.Uuid
  categoryId String
  cost       Int
  frequency  String
  projectId  String  @db.Uuid
  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model LaborCost {
  id          String  @id @default(uuid()) @db.Uuid
  categoryId  String
  cost        Int
  description String
  frequency   String
  projectId   String  @db.Uuid
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model WasteHaulingCost {
  id          String  @id @default(uuid()) @db.Uuid
  monthlyCost Int
  wasteStream String
  serviceType String
  projectId   String  @db.Uuid
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Dishwasher {
  id String @id @default(uuid()) @db.Uuid

  additionalRacksPerDay       Int
  boosterWaterHeaterFuelType  String
  buildingWaterHeaterFuelType String
  energyStarCertified         Boolean
  operatingDays               Int
  temperature                 String
  type                        String
  projectId                   String  @db.Uuid
  project                     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

enum Role {
  ORG_ADMIN
  ACCOUNT_ADMIN
}
