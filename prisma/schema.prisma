// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          String   @id
  name        String?
  email       String   @unique
  title       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  org         Org      @relation(fields: [orgId], references: [id], onDelete: Cascade)
  orgId       String   @db.Uuid
  account     Account? @relation(fields: [accountId], references: [id])
  accountId   String?  @db.Uuid
  phone       String?
  role        Role     @default(ORG_ADMIN)
  invitesSent Invite[]
}

model Org {
  id         String    @id @default(uuid()) @db.Uuid
  name       String
  metadata   Json?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  isUpstream Boolean   @default(false)
  users      User[]
  accounts   Account[]
  projects   Project[]
  Invite     Invite[]
}

model Account {
  id                  String    @id @default(uuid()) @db.Uuid
  name                String
  metadata            Json?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  accountContactEmail String
  USState             String    @default("California")
  org                 Org       @relation(fields: [orgId], references: [id], onDelete: Cascade)
  orgId               String    @db.Uuid
  users               User[]
  invites             Invite[]
  projects            Project[]
}

model Invite {
  id           String   @id @default(uuid()) @db.Uuid
  email        String
  account      Account? @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId    String?  @db.Uuid
  orgId        String   @db.Uuid
  org          Org      @relation(fields: [orgId], references: [id], onDelete: Cascade)
  accepted     Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  sentBy       User     @relation(fields: [sentByUserId], references: [id], onDelete: Cascade)
  sentByUserId String
}

model Project {
  id                String              @id @default(uuid()) @db.Uuid
  name              String
  metadata          Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  org               Org                 @relation(fields: [orgId], references: [id], onDelete: Cascade)
  orgId             String              @db.Uuid
  account           Account             @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId         String              @db.Uuid
  singleUseItems    SingleUseLineItem[]
  reusableItems     ReusableLineItem[]
  otherExpenses     OtherExpense[]
  laborCosts        LaborCost[]
  wasteHaulingCosts WasteHaulingCost[]
  dishwashers       Dishwasher[]
}

model SingleUseLineItem {
  id                String  @id @default(uuid()) @db.Uuid
  caseCost          Float
  casesPurchased    Int
  frequency         String
  productId         String
  newCaseCost       Float
  newCasesPurchased Int
  unitsPerCase      Int
  project           Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId         String  @db.Uuid
}

model ReusableLineItem {
  id                         String  @id @default(uuid()) @db.Uuid
  annualRepurchasePercentage Float
  caseCost                   Float
  casesPurchased             Int
  categoryId                 String
  productName                String
  projectId                  String  @db.Uuid
  project                    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model OtherExpense {
  id          String  @id @default(uuid()) @db.Uuid
  categoryId  String
  cost        Float
  description String
  frequency   String
  projectId   String  @db.Uuid
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model LaborCost {
  id          String  @id @default(uuid()) @db.Uuid
  categoryId  String
  cost        Float
  description String
  frequency   String
  projectId   String  @db.Uuid
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model WasteHaulingCost {
  id             String  @id @default(uuid()) @db.Uuid
  monthlyCost    Float
  newMonthlyCost Float
  wasteStream    String
  serviceType    String
  description    String
  projectId      String  @db.Uuid
  project        Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Dishwasher {
  id String @id @default(uuid()) @db.Uuid

  racksPerDay                 Int     @default(0)
  additionalRacksPerDay       Int
  newRacksPerDay              Int     @default(0)
  boosterWaterHeaterFuelType  String?
  buildingWaterHeaterFuelType String
  energyStarCertified         Boolean
  operatingDays               Int
  newOperatingDays            Int     @default(0)
  temperature                 String
  type                        String
  projectId                   String  @db.Uuid
  project                     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

enum Role {
  ORG_ADMIN
  ACCOUNT_ADMIN
}
